# ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô (Login Security Audit)

**‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:** ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á ‡πÅ‡∏•‡∏∞‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà  
**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à:** ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠  
**‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï:** NextAuth (Credentials), ‡∏´‡∏ô‡πâ‡∏≤ Login, Middleware, API ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ session

---

## ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à (Executive Summary)

| ‡∏£‡∏∞‡∏î‡∏±‡∏ö | ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ |
|--------|--------|--------|
| ‡∏î‡∏µ‡∏°‡∏≤‡∏Å | ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (bcrypt), CSRF, ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô API ‡∏î‡πâ‡∏ß‡∏¢ session | ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô |
| ‡∏î‡∏µ | Rate limiting, ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, JWT session | ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô |
| ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á | Cookie secure, ‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏Ñ‡∏á‡∏ó‡∏µ‡πà (timing), ‡∏Ç‡∏ô‡∏≤‡∏î input | ‚ö†Ô∏è ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ |
| ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å | NEXTAUTH_SECRET, HTTPS, ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏ô Sheet | üìå ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö deployment |

**‡∏Ç‡πâ‡∏≠‡∏™‡∏£‡∏∏‡∏õ:** ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏° **‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö production ‡πÑ‡∏î‡πâ** ‡∏´‡∏≤‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ environment ‡πÅ‡∏•‡∏∞ deployment ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏£‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏õ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°

---

## Step 1: ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Password Storage & Verification)

### 1.1 ‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô

- **‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö:** Google Sheet (Users sheet), ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô **hash** ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö plain text
- **‡∏≠‡∏±‡∏•‡∏Å‡∏≠‡∏£‡∏¥‡∏ó‡∏∂‡∏°:** ‡πÉ‡∏ä‡πâ **bcrypt** ‡∏ú‡πà‡∏≤‡∏ô `bcrypt.compare()` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
- **‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à:** ‚úÖ **‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á** ‚Äî bcrypt ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏°‡∏µ salt, ‡∏õ‡∏£‡∏±‡∏ö cost ‡πÑ‡∏î‡πâ)

### 1.2 ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏ô‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î

- ‡πÄ‡∏ß‡∏•‡∏≤ **‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà** ‡∏´‡∏£‡∏∑‡∏≠ **‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô** ‡∏ï‡πâ‡∏≠‡∏á hash ‡∏î‡πâ‡∏ß‡∏¢ `bcrypt.hash(plainPassword, 10)` (‡∏´‡∏£‡∏∑‡∏≠ salt rounds ‡πÑ‡∏°‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 10) ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞ hash ‡∏•‡∏á Sheet
- ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö plain text ‡∏´‡∏£‡∏∑‡∏≠ hash ‡πÅ‡∏ö‡∏ö‡∏≠‡πà‡∏≠‡∏ô (‡πÄ‡∏ä‡πà‡∏ô MD5/SHA1 ‡πÑ‡∏°‡πà‡∏°‡∏µ salt) ‡πÉ‡∏ô Sheet

### 1.3 ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î

- ‡πÉ‡∏ä‡πâ `bcrypt.compare(credentials.password, user.passwordHash)` ‚Äî ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà client ‡∏´‡∏£‡∏∑‡∏≠ log

---

## Step 2: ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô CSRF (Cross-Site Request Forgery)

- NextAuth v4 ‡∏°‡∏µ **CSRF token** ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö flow credentials
- Client ‡∏£‡∏±‡∏ö CSRF token (‡∏à‡∏≤‡∏Å `/api/auth/csrf`) ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏° POST ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
- **‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à:** ‚úÖ **‡∏°‡∏µ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô CSRF** ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà NextAuth ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö

---

## Step 3: ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Session ‡πÅ‡∏•‡∏∞ JWT

### 3.1 ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå Session

- ‡πÉ‡∏ä‡πâ **JWT strategy** (`strategy: 'jwt'`)
- `maxAge`: ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å `NEXTAUTH_JWT_MAXAGE` (default 28800 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ = 8 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)

### 3.2 Cookie

- NextAuth ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ session cookie ‡πÄ‡∏≠‡∏á (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á `httpOnly` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á XSS ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡πÇ‡∏°‡∏¢ session)
- **‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:** ‡πÉ‡∏ô production ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ HTTPS ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ NextAuth ‡πÉ‡∏ä‡πâ secure cookie (‡πÇ‡∏î‡∏¢‡∏õ‡∏Å‡∏ï‡∏¥‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ `NEXTAUTH_URL` ‡πÄ‡∏õ‡πá‡∏ô `https://`)

### 3.3 ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Session

- ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ `id`, `name`, `use_sheet` ‚Äî ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏±‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô session  
- **‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à:** ‚úÖ **‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°**

---

## Step 4: ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Brute Force ‡πÅ‡∏•‡∏∞ Rate Limiting

### 4.1 Middleware (/api/auth/*)

- ‡πÉ‡∏ä‡πâ **Upstash Redis** + **Sliding Window**: ‡∏à‡∏≥‡∏Å‡∏±‡∏î **5 ‡∏Ñ‡∏≥‡∏Ç‡∏≠ POST ‡∏ï‡πà‡∏≠ 1 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏ï‡πà‡∏≠ IP**
- ‡∏≠‡πà‡∏≤‡∏ô IP ‡∏à‡∏≤‡∏Å `x-forwarded-for`, `cf-connecting-ip`, `x-real-ip` (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö proxy/CDN)
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤: ‡∏Ñ‡∏∑‡∏ô **429** ‡πÅ‡∏•‡∏∞ `Retry-After`

### 4.2 ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Redis ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°

- ‡∏ñ‡πâ‡∏≤ Upstash ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠ fetch ‡∏•‡πâ‡∏° ‡∏£‡∏∞‡∏ö‡∏ö **‡∏õ‡∏•‡πà‡∏≠‡∏¢ request ‡∏ú‡πà‡∏≤‡∏ô** (‡πÑ‡∏°‡πà‡∏ö‡∏•‡πá‡∏≠‡∏Å login)
- **‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á:** ‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà Redis ‡∏•‡πâ‡∏° ‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å brute force ‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô  
- **‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:** ‡πÉ‡∏ô production ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ Redis ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° fallback rate limit ‡πÅ‡∏ö‡∏ö in-memory ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£

### 4.3 ‡∏™‡∏£‡∏∏‡∏õ

- **‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à:** ‚úÖ **‡∏°‡∏µ rate limiting ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô** ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Upstash ‡∏Ñ‡∏£‡∏ö

---

## Step 5: ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Error ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

- ‡∏´‡∏ô‡πâ‡∏≤ login ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ: **"‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"**
- ‡πÑ‡∏°‡πà‡πÅ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ ‚Äú‡πÑ‡∏°‡πà‡∏°‡∏µ user ‡∏ô‡∏µ‡πâ‚Äù ‡∏´‡∏£‡∏∑‡∏≠ ‚Äú‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î‚Äù  
- **‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à:** ‚úÖ **‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏ß‡πà‡∏≤‡∏°‡∏µ user ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà** (‡∏•‡∏î‡∏Å‡∏≤‡∏£ enumerate username)

---

## Step 6: ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô API ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô

- API ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (‡πÄ‡∏ä‡πà‡∏ô `/api/google-sheets`) ‡πÉ‡∏ä‡πâ **getServerSession(authOptions)**
- ‡∏ï‡∏£‡∏ß‡∏à `session?.user?.use_sheet` ‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏∂‡∏á/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‡πÑ‡∏°‡πà‡∏°‡∏µ session ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ use_sheet ‚Üí ‡∏Ñ‡∏∑‡∏ô **401 Unauthorized**
- **‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à:** ‚úÖ **‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á API ‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢ session**

---

## Step 7: ‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡πÅ‡∏ö‡∏ö Timing (Timing Attack)

- ‡∏ñ‡πâ‡∏≤ ‚Äú‡πÑ‡∏°‡πà‡∏°‡∏µ user‚Äù ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `bcrypt.compare` ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤ ‚Äú‡∏°‡∏µ user ‡πÅ‡∏ï‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î‚Äù ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `bcrypt.compare` ‚Üí ‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏≠‡∏≤‡∏à‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
- ‡∏ú‡∏π‡πâ‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠ **‡πÄ‡∏î‡∏≤‡∏ß‡πà‡∏≤‡∏°‡∏µ username ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà**
- **‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á:** ‡∏ï‡πà‡∏≥ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏µ rate limit ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error ‡πÑ‡∏°‡πà‡πÅ‡∏¢‡∏Å)
- **‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:** ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ ‚Äú‡∏°‡∏µ user / ‡πÑ‡∏°‡πà‡∏°‡∏µ user‚Äù ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å dummy compare ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏û‡∏ö user) ‚Äî ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

---

## Step 8: Input Validation ‡πÅ‡∏•‡∏∞ DoS

- ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß** username/password ‡πÉ‡∏ô authorize
- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á string ‡∏¢‡∏≤‡∏ß‡∏°‡∏≤‡∏Å ‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ CPU/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô (‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô bcrypt)
- **‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:** ‡∏Ñ‡∏ß‡∏£‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß (‡πÄ‡∏ä‡πà‡∏ô username ‚â§ 100, password ‚â§ 128) ‡πÅ‡∏•‡∏∞ trim ‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏£‡∏ß‡∏à

---

## Step 9: ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Environment / Deployment

| ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ |
|--------|-----------|----------|
| **NEXTAUTH_SECRET** | ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å | ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏™‡∏∏‡πà‡∏°‡∏¢‡∏≤‡∏ß (‡πÄ‡∏ä‡πà‡∏ô 32+ ‡∏ï‡∏±‡∏ß) ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ JWT/cookie |
| **NEXTAUTH_URL** | ‡∏™‡∏π‡∏á | ‡πÉ‡∏ô production ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô URL ‡∏à‡∏£‡∏¥‡∏á ‡πÄ‡∏ä‡πà‡∏ô `https://yourdomain.com` |
| **HTTPS** | ‡∏™‡∏π‡∏á | ‡πÉ‡∏ä‡πâ HTTPS ‡πÉ‡∏ô production ‡πÄ‡∏û‡∏∑‡πà‡∏≠ secure cookie ‡πÅ‡∏•‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏±‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• |
| **UPSTASH_REDIS_*** | ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á | ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ rate limit ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö |
| **GOOGLE_SHEETS_*** / GOOGLE_SHEET_USER_ID | ‡∏™‡∏π‡∏á | ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á user ‡∏à‡∏≤‡∏Å Sheet ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå |

---

## Step 10: ‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°

### ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á

1. ‡πÉ‡∏ä‡πâ **bcrypt** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö plain text
2. **CSRF** ‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏¢ NextAuth
3. **Session/JWT** ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏±‡∏ö‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
4. **Rate limiting** ‡∏ö‡∏ô `/api/auth/*` (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ Upstash)
5. ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error **‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢** ‡∏ß‡πà‡∏≤‡∏°‡∏µ user ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
6. **API ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ session** ‡∏ú‡πà‡∏≤‡∏ô getServerSession ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏° (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)

1. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î **useSecureCookies** ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤ production ‡πÉ‡∏ä‡πâ HTTPS
2. **‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß** username/password (‡πÅ‡∏•‡∏∞ trim) ‡πÉ‡∏ô authorize
3. (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏î timing leak) ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ **‡∏Ñ‡∏á‡∏ó‡∏µ‡πà** ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏û‡∏ö user
4. ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤ **‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏ô Google Sheet** ‡πÉ‡∏ä‡πâ bcrypt.hash ‡∏î‡πâ‡∏ß‡∏¢ salt rounds ‚â• 10 ‡πÄ‡∏™‡∏°‡∏≠

---

## ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏°‡∏ï‡∏µ

| ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏°‡∏ï‡∏µ | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ |
|------------------|--------|----------|
| Brute force ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô | ‚úÖ ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÑ‡∏î‡πâ‡∏î‡∏µ | ‡∏°‡∏µ rate limit ‡∏ï‡πà‡∏≠ IP |
| CSRF | ‚úÖ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô | NextAuth CSRF token |
| ‡∏Å‡∏≤‡∏£‡∏Ç‡πÇ‡∏°‡∏¢ session (XSS) | ‚úÖ ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á | cookie ‡πÄ‡∏õ‡πá‡∏ô httpOnly |
| ‡∏Å‡∏≤‡∏£ enumerate username | ‚ö†Ô∏è ‡∏•‡∏î‡πÑ‡∏î‡πâ‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô | ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error ‡πÑ‡∏°‡πà‡πÅ‡∏¢‡∏Å; timing ‡∏¢‡∏±‡∏á‡∏ï‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ |
| SQL/NoSQL Injection | ‚úÖ ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á | ‡πÉ‡∏ä‡πâ Google Sheets API, ‡πÑ‡∏°‡πà‡∏°‡∏µ query string ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á |
| ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏±‡πà‡∏ß‡∏à‡∏≤‡∏Å DB | ‚úÖ ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á | ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô bcrypt hash |

‡∏´‡∏≤‡∏Å‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÑ‡∏õ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏à‡∏∞ **‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏°‡∏ï‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô production ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à**
